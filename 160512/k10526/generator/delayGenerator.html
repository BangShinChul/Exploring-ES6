<html>
<body>
    <div id = 'move' style="position:relative;width:500px;height:500px;border:1px solid #000000">
        <div style="position:relative;top:10px;left:10px;width:50px;height:50px;border:1px solid #000000"></div>
        <div style="position:relative;top:20px;left:10px;width:50px;height:50px;border:1px solid #000000"></div>
        <div style="position:relative;top:30px;left:10px;width:50px;height:50px;border:1px solid #000000"></div>
        <div style="position:relative;top:40px;left:10px;width:50px;height:50px;border:1px solid #000000"></div>
        <div style="position:relative;top:50px;left:10px;width:50px;height:50px;border:1px solid #000000"></div>
        <div style="position:relative;top:60px;left:10px;width:50px;height:50px;border:1px solid #000000"></div>
        <div style="position:relative;top:70px;left:10px;width:50px;height:50px;border:1px solid #000000"></div>
    </div>
<script>
class Task{
	constructor(target){
		this._target = target;
		this._val = null;
		this._stack = [];
	}
	run(){
		const {value,done} = this._target.next(this._val);
		if(done){
			if(this._stack.length===0) return null;
			this._val = null;
			this._target = this._stack.pop();
		}else if(value&&value.then){
			return value;
		}else if(value&&value[Symbol.iterator]){
			this._stack.push(this._target);
			this._val = null;
			this._target = value;
		}else{
			this._val = value;
		}
	}
}
class Scheduler{
	constructor(){
		this._queue = [];
		this._numTask = 0;
	}
	newTask(target){
		this._numTask++;
		this.schedule(new Task(target));
	}
	schedule(task){
		this._queue.push(task);
	}
	loop(){
		const r= _=>{
			if(this._numTask){
				while(this._queue.length){
					const task = this._queue.shift();
					const result = task.run();
					if(result === null){
						this._numTask--;
					}else if(result&&result.then){
						result.then(val=>{task._val=val;this.schedule(task)});
					}else {
						this.schedule(task);	
					}
				}
				setTimeout(r,15);
			}
		}
		r();
	}
}
function timeout(time){
	return new Promise(function(res){setTimeout(res,time)});
}
function coroutine(gen){
	return function(...args){
		const genObj = gen(...args);
		genObj.next();
		return genObj;
	}
}
const s = new Scheduler();
function* leftMoveBox(el){
	let left = 0;
	while(left<440){
		left = left + 5;
		el.style.left = left + 'px';
		yield timeout(30);
	}
}	
function* rightMoveBox(el){
	let left = 440;
	while(left>0){
		left = left -5;
		el.style.left = left + 'px';
		yield timeout(30);
	}
}
function* leftRightMoveBox(el){
	while(true){
		yield coroutine(leftMoveBox)(el);
		yield coroutine(rightMoveBox)(el)
	}
}
s.newTask(function* (){console.log(1);yield timeout(100); console.log(2);yield;console.log(3)}());
s.newTask(function* (){console.log(1);const a = yield 2;console.log(a);yield;console.log(3)}());
s.newTask(coroutine(leftMoveBox)(document.getElementById('move').children[0]));
s.newTask(coroutine(rightMoveBox)(document.getElementById('move').children[1]));
s.newTask(coroutine(leftRightMoveBox)(document.getElementById('move').children[2]));
</script>
</body>
</html>
